generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id           String   @id @default(cuid())
  username     String   @unique
  passwordHash String
  createdAt    DateTime @default(now())
}

model Product {
  id        String       @id @default(cuid())
  sku       String       @unique            // Product ID from Excel
  name      String                          // Product Name from Excel
  createdAt DateTime     @default(now())
metrics   DailyMetric[]
}

model DailyMetric {
  id                   String   @id @default(cuid())
  productId            String
  date                 DateTime                    // Converted from Day N using start date
  openingInventory     Int                         // Opening inventory for this date
  procurementQty       Int        @default(0)     // Daily procurement quantity
  procurementUnitPrice Decimal?   @db.Decimal(10,2) // Daily procurement unit price
  salesQty             Int        @default(0)     // Daily sales quantity
  salesUnitPrice       Decimal?   @db.Decimal(10,2) // Daily sales unit price
  // Metadata for tracking import batches
  uploadBatchId        String?

  product     Product      @relation(fields: [productId], references: [id])
  uploadBatch UploadBatch? @relation(fields: [uploadBatchId], references: [id])

  @@unique([productId, date])                     // Idempotent import: one record per product per date
  @@index([productId, date])                      // Common query optimization
}

model UploadBatch {
  id         String        @id @default(cuid())
  filename   String
  uploadedBy String
  createdAt  DateTime      @default(now())
  metrics    DailyMetric[]
}
